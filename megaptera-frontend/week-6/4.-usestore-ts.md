# 4. usestore-ts

## usesotre-ts

### ì„¤ì¹˜

```bash
npm install usestore-ts
```

#### Configure TypeScript

<mark style="background-color:yellow;">`tsconfig.json`</mark> ìˆ˜ì •

```json
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
```



### Store ì‘ì„±

```typescript
import { singleton } from 'tsyringe';

import { Store, Action } from 'usestore-ts';

@singleton()
@Store()
export default class CounterStore {
	count = 0;
	
	@Action()
	increase(step = 1) {
		this.count += step;
	}
	
	@Action()
	decrease() {
		this.count -= 1;
	}
}
```

### Custom Hook ì‘ì„±

```typescript
import { container } from 'tsyringe';

import { useStore } from 'usestore-ts';

import CounterStore from '../stores/CounterStore';

export default function useCounterStore() {
	const store = container.resolve(CounterStore);
	return useStore(store);
}
```



ë¹„ë™ê¸° í•¨ìˆ˜ì— <mark style="color:red;">`@Action`</mark>ì„ ë¶™ì´ë©´ ë‹¤ë¥´ê²Œ ì‘ë™í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì— ì£¼ì˜í•´ì•¼í•œë‹¤. ë³„ë„ì˜ ì•¡ì…˜ì„ ë§Œë“¤ë©´ ì‹ ê²½ ì“¸ ë¶€ë¶„ì´ ì¤„ì–´ë“ ë‹¤.

```typescript
@singleton()
@Store()
class PostStore {
	posts: Post[] = [];
	
	async fetchPosts() {
		this.startLoading();
	
		const posts = await fetchPosts();

		this.completeLoading(posts);
	}
	
	@Action()
	startLoading() {
		this.posts = [];
	}
	
	@Action()
	completeLoading(posts: Post[]) {
		this.posts = posts;
	}
}
```

## useSyncExternalStore

ğŸ“ [ê³µì‹ë¬¸ì„œ](https://react.dev/reference/react/useSyncExternalStore)

external stateì˜ ë³€ê²½ì‚¬í•­ì„ ëª¨ë‹ˆí„°ë§ í•˜ë‹¤ê°€ tearingì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ìƒíƒœ ë³€í™”ê°€ í™•ì¸ë˜ë©´ ë‹¤ì‹œ ë Œë”ë§ì„ ì‹œì‘í•œë‹¤.

```typescript
const state = useSyncExternalStore (
    subscribe,
    getSnapshot,
    getServerSnapshot
);
```

* subscribe: storeê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œ í˜¸ì¶œí•  callback í•¨ìˆ˜
* getSnapshot: storeì˜ í˜„ì¬ ê°’ì„ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜
* getServerSnapshot: ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ ì‹œ ê°€ì§€ê³  ìˆë˜ snapshotì„ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜

#### ì‹¤ì œ í˜¸ì¶œ ì½”ë“œ

```typescript
const state = useSyncExternalStore(store.subscribe, store.getSnapshot);
```

`store.getSnapshot`ì€ ì§ì „ ë Œë”ë§ ì‹œì ê³¼ ë¹„êµí•´ ìŠ¤í† ì–´ì˜ ìƒíƒœ ê°’ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ë„£ëŠ” ê°’ì´ë‹¤. getSnapShot()ì€ ê¸°ë³¸ì ì¸ number, string ê°’ì¼ ìˆ˜ë„ ìˆê³ , _<mark style="background-color:purple;">ë©”ëª¨ì´ì œì´ì…˜</mark>_ëœ objectì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

{% hint style="info" %}
ë©”ëª¨ì´ì œì´ì…˜

ë©”ëª¨ì´ì œì´ì…˜(memoization)ì€ ì»´í“¨í„° í”„ë¡œê·¸ë¨ì´ ë™ì¼í•œ ê³„ì‚°ì„ ë°˜ë³µí•´ì•¼ í•  ë•Œ, ì´ì „ì— ê³„ì‚°í•œ ê°’ì„ ë©”ëª¨ë¦¬ì— ì €ì¥í•¨ìœ¼ë¡œì¨ ë™ì¼í•œ ê³„ì‚°ì˜ ë°˜ë³µ ìˆ˜í–‰ì„ ì œê±°í•˜ì—¬ í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì†ë„ë¥¼ ë¹ ë¥´ê²Œ í•˜ëŠ” ê¸°ìˆ 
{% endhint %}



### ì‚¬ìš©í•˜ê¸°

```typescript
import { useSyncExternalStore } from 'react'

const useStore = (store, selector) => {
  return useSyncExternalStore(
    store.subscribe,
    useCallback(() => selector(store.getState(), [store, selector])),
  )
}
```

useExternalStoreë¥¼ ì‚¬ìš©í•´ì„œ useStore ë‚´ë¶€ë¥¼ ë³€ê²½í•˜ì—¬, ì—…ë°ì´íŠ¸ ëœ ìƒíƒœê°’ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

![](<../../.gitbook/assets/image (8).png>)

subscribe apië¥¼ ì œê³µí•˜ëŠ” ì–´ë–¤ storeë“ ì§€ ìƒê´€ ì—†ì´ useSyncExternalStoreë¥¼ í™œìš©í•˜ë©´ concurrent featureì—ì„œ ë°œìƒí•˜ëŠ” tearingì„ ì˜ˆë°©í•  ìˆ˜ ìˆë‹¤.
